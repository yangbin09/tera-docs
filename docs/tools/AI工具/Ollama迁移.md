# Windows 系统下将 Ollama 模型缓存目录迁移到 D 盘的完整教程

> 本文档适用于希望将 Ollama 的默认模型存储目录从 C 盘迁移到 D 盘的用户，尤其适用于 C 盘空间不足的情况。

## 📝 内容概述

Ollama 是一个强大的本地大语言模型运行工具，但其默认将模型文件存储在 C 盘用户目录下。由于大模型文件体积庞大（通常数 GB），容易导致 C 盘空间不足。本教程提供两种有效的迁移方法，帮助用户将模型存储位置迁移到 D 盘。

## 🎯 核心要点

### 📁 默认情况说明

Ollama 默认将模型文件存储在路径：
```
C:\Users\你的用户名\.ollama\models
```

大模型（如 DeepSeek-R1-1.5B）体积可达数 GB，容易导致 C 盘空间不足。

### ✅ 方法一：通过环境变量修改模型目录

Ollama 支持通过设置系统环境变量 `OLLAMA_MODELS` 来指定模型缓存位置。

#### 🔧 操作步骤：

1. **在 D 盘创建新目录**
   
   打开资源管理器，新建目录：
   ```
   D:\ollama\models
   ```

2. **设置环境变量**
   
   - 打开开始菜单，搜索并打开「编辑系统环境变量」
   - 点击右下角的「环境变量」按钮
   - 在「用户变量」中点击「新建」，填写：
     - 变量名：`OLLAMA_MODELS`
     - 变量值：`D:\ollama\models`
   
   ✅ 确认无误后，点击「确定」保存。

3. **重启终端或系统**
   
   让新环境变量生效。

4. **运行模型**
   
   在命令提示符或 PowerShell 中运行：
   ```bash
   ollama run deepseek-r1:1.5b
   ```
   
   模型文件将会自动下载或使用 D 盘目录进行缓存。

### ✅ 方法二：使用符号链接迁移 `.ollama` 文件夹

如果你希望 Ollama 继续使用默认路径，但将内容物实际保存在 D 盘，也可以使用软链接（符号链接）实现。

#### ⚠️ 注意事项：

- 本方法会彻底把 `.ollama` 文件夹从 C 盘移动到 D 盘
- 需要使用「管理员权限」运行命令提示符

#### 🧰 操作步骤：

1. **关闭 Ollama**
   
   确保 Ollama 没有正在运行。

2. **将 `.ollama` 文件夹移动到 D 盘**
   
   打开管理员命令提示符，执行：
   ```bash
   robocopy "C:\Users\你的用户名\.ollama" "D:\ollama" /E /MOVE
   ```
   
   > `/E` 表示复制所有子目录，`/MOVE` 表示移动而非复制。

3. **创建目录软链接**
   
   继续在管理员命令行中执行：
   ```bash
   mklink /D "C:\Users\你的用户名\.ollama" "D:\ollama"
   ```
   
   成功后，Windows 会在原路径下建立一个链接，指向 D 盘的新目录。

4. **测试模型运行**
   
   运行命令测试是否正常：
   ```bash
   ollama run deepseek-r1:1.5b
   ```
   
   如果模型成功加载且不报错，迁移完成 ✅

### 📌 两种方法对比

| 方法 | 推荐程度 | 是否易恢复 | 是否适合新手 |
|------|---------|-----------|-------------|
| 环境变量设置法 | ⭐⭐⭐⭐⭐ | ✅ 易恢复 | ✅ 非常适合 |
| 软链接迁移法 | ⭐⭐⭐⭐ | ❌ 稍复杂 | ⚠️ 稍进阶 |

## 💡 应用建议

### 🎯 推荐使用场景
- C 盘空间不足，需要释放存储空间
- 使用多个大型模型，需要更大的存储空间
- 系统优化，将数据文件与系统文件分离

### ⚠️ 注意事项
- 迁移前请确保 D 盘有足够的可用空间
- 建议先备份重要的模型配置文件
- 使用软链接方法时，请务必以管理员权限运行命令
- 迁移完成后，建议测试所有常用模型是否正常运行

### 🧹 可选清理建议

完成迁移后，你可以手动删除原来 C 盘中的 `.ollama`（如果使用软链接则不用手动清理）：
```bash
rmdir /S /Q "C:\Users\你的用户名\.ollama"
```

## 📋 相关标签

`Ollama` `模型迁移` `Windows系统` `环境变量` `符号链接` `存储优化`

## 🔗 相关链接

- [Ollama 官方文档](https://ollama.ai/docs)
- Windows 环境变量设置指南（待补充）
- 系统存储优化建议（待补充）

---

*最后更新: 2025-01-27*
*分类: 工具辅助类*