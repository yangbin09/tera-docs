
本教程将手把手带你从一个空白的 n8n 画布开始，一步一步构建一个高级 AI 聊天机器人。

**我们将实现以下功能：**

1. **专家人设：** AI 将扮演一个“双身份语文导师”，使用你提供的、包含复杂规则的“系统提示词”来回答问题。
    
2. **流式聊天：** 提供一个公开的聊天网址，AI 的回复会像 ChatGPT 一样一个字一个字地“流式”显示。
    
3. **上下文记忆：** AI 能记住之前的对话内容，可以进行多轮对话。
    
4. **自动存档：** AI 的每一次完整回复，都会在 n8n 后台自动生成一个精美的 HTML 文件，供你下载和存档。
    

### 准备工作

在开始之前，你必须准备好两样东西：

1. **n8n 实例：** 确保你的 n8n 已经安装并可以正常访问（无论是本地、1Panel 还是云端）。
    
2. **DeepSeek API 密钥：**
    
    - 访问 `https://platform.deepseek.com/` 注册并登录。
        
    - 在“API 密钥”页面创建一个新密钥，并**复制保存好**这串 `sk-...` 开头的字符。
        

---

## 搭建流程

我们将按照“搭建骨架” -> “安装组件” -> “注入灵魂” -> “激活测试”的顺序进行。

### 🌍 Part 1：搭建工作流的“骨架” (The Main Flow)

我们先把工作流的主干道（用户输入 -> AI 处理 -> 文件输出）搭建起来。

#### 步骤一：添加“聊天触发器” (Chat Trigger)

这是用户与 AI 交互的界面。

1. 在 n8n 中新建一个工作流。
    
2. 点击 `+` 号添加节点，在搜索框中输入 `Chat Trigger`，并添加它。
![](Pasted_image_20251022205133.png)
3. 点击 "Chat Trigger" 节点，在右侧的配置面板中：
    
    - **Public (公开):** **必须勾选**。这会生成一个公开的 URL 网址，否则你无法从外部访问聊天窗

![](Pasted_image_20251022205314.png)
        

#### 步骤二：添加“AI 代理” (AI Agent)

这是工作流的“指挥官”，我们先放一个空的在这里。

1. 点击 "Chat Trigger" 节点后面的 `+` 号。
    
2. 搜索并添加 **"AI Agent"** 节点。
    
![](Pasted_image_20251022205355.png)
#### 步骤三：添加“Markdown 转换器” (Markdown)

`AI Agent` 输出的是 Markdown 文本，我们需要把它转换成 HTML。

1. 点击 "AI Agent" 节点后面的 `+` 号。
    
2. 搜索并添加 **"Markdown"** 节点。
    
3. 配置 "Markdown" 节点：
    
    - **Mode (模式):** 确保选择的是 `markdownToHtml` (Markdown 转 HTML)。
        
    - **Markdown:** 点击输入框右侧的 `</>` 按钮切换到“表达式”模式。
        
    - 输入 `={{ $json["output"] }}`
        
    - _解释：`output` 是 `AI Agent` 在流式回复结束后，输出的那个**完整回复文本**。_
        
    - **Options (选项):** 点击 `Add option` -> 选择 `Create Full HTML Document` (创建完整 HTML 文档) -> 确保开关为**开启 (true)**。
        
    - _解释：这会生成包含 `<html>` 和 `<body>` 标签的完整网页，而不是 HTML 碎片。_
        
![](Pasted_image_20251022205445.png)
#### 步骤四：添加“文件转换器” (Convert to File)

这是你之前卡住的节点。我们将使用我们最后调试成功的正确配置。

1. 点击 "Markdown" 节点后面的 `+` 号。
    
2. 搜索并添加 **"Convert to File"** 节点。
![](Pasted_image_20251022205632.png)
3. 在右侧 "Actions" (操作) 列表中，选择 **`Convert to text file`** (转换为文本文件)。
![](Pasted_image_20251022205650.png)
4. 配置 `Convert to text file`：
    
    - **Text Input Field (文本输入字段):** 输入 `data`
        
    - _解释：这会抓取上一步 `Markdown` 节点输出的、存放在 `data` 字段里的 HTML 字符串。_
        
    - **Put Output File in Field (文件输出字段):** 输入 `data`
        
    - _解释：这会用新生成的文件对象，替换掉原来的 `data` 字符串。_
        
    - **Options (选项):** 点击 `Add option` -> 选择 **`File Name` (文件名)** -> 输入 `语文导师回复.html`
        
    - **Options (选项):** 再次点击 `Add option` -> 选择 **`MIME Type`** -> 输入 `text/html`
        
    - _解释：这是最关键的一步！它告诉浏览器“这是一个网页，请渲染它”，而不是把它当成纯文本显示。_
        
![](Pasted_image_20251022205756.png)
---

### 🧠 Part 2：添加“AI 组件” (The Utility Nodes)

现在我们的“骨架”搭好了，但 AI 还没有“大脑”和“记忆”。这些组件是独立添加，然后“插”在 `AI Agent` 上的。

#### 步骤五：添加“DeepSeek 引擎” (DeepSeek Chat Model)

1. 在画布的**AI Agent 处**（_不要_连接到任何节点上）点击 `+` 号。
    
2. 搜索并添加 **"DeepSeek Chat Model"** 节点。
![](Pasted_image_20251022205905.png)
    
3. **配置凭证 (Credential)：**
    
    - 点击 "Credential" (凭证) 下拉框，选择 **"Create New" (新建)**。
        
    - **Name (名称):** 随意填写，比如 `我的 DeepSeek 密钥`。
        
    - **API Key (API 密钥):** 粘贴你准备好的 `sk-...` 密钥。
![](Pasted_image_20251022205927.png)
        
    - 点击 **"Save" (保存)**。
        
        

#### 步骤六：添加“AI 记忆” (Simple Memory)

1. 在画布的**空白处**再次点击 `+` 号。
    
2. 搜索并添加 **"Simple Memory"** 节点。（无需任何配置）。
    
        
![](Pasted_image_20251022210037.png)
---

### 👻 Part 3：注入“灵魂” (The System Prompt)

这是你整个工作流最核心、最亮眼的部分。

1. 点击“骨架”中的 **"AI Agent"** 节点。
    
2. 在右侧的配置面板中，找到 **"Options" (选项)** 区域。
    
3. 点击 **"Add Option" (添加选项)** -> **"System Message" (系统消息)**。
    
4. 在 "System Message" 的输入框中，**完整粘贴**以下（你提供的）“超级提示词”：
    
    Plaintext
    
    ```
    你现在是【双身份语文导师】：
    1. 省级正高级语文教研员（10 年阅卷组长）
    2. 中国作协会员（散文专栏作家）
    人设关键词：典雅、亲切、典故活字典、修辞工匠、阅卷视角、模板狂魔。
    
    任务目标：
    用“章回体”回答用户任意提问，确保：
    ① 每篇 1500±100 字；
    ② 至少 7 大章，每章标题 14 字且对仗；
    ③ 总典故≥5 个（括号注释出处）；
    ④ 金句≥3 组，写作模板≥1 套，ASCII 思维导图 1 张；
    ⑤ 结构固定：序章破题→起承转合→升章拓展→尾章回环；
    ⑥ 语言节奏：长句≤28 字，短句≥2 字，长短比 3:7；
    ⑦ 每 300 字必有“如果…为什么…”双重提问；
    ⑧ 案例双轨：古—今+中—外，并含时间+数字；
    ⑨ 尾章把首章古诗倒装升华，形成闭环。
    
    输出格式（严格）：
    【第壹章 ××××××××××】（引子·破题）
    【第贰章 ××××××××××】（概念·澄清）
    【第叁章 ××××××××××】（技法·拆解）
    【第肆章 ××××××××××】（误区·会诊）
    【第伍章 ××××××××××】（现场·微范文）
    【第陆章 ××××××××××】（拓展·书单）
    【第柒章 ××××××××××】（回环·升华）
    附录：
    1. 金句速记 3 组
    2. 万能写作模板 1 套
    3. ASCII 思维导图
    
    可调参数：
    用户输入“/short”→压缩 500 字，保留 3 章；
    输入“/long”→扩至 2500 字，增“番外篇”；
    输入“/exam”→切换应试模式，典故降维至教材内；
    输入“/media”→切换自媒体模式，标题加 emoji，口语 +30%。
    
    语气标尺：
    典雅≤40%，亲切≤60%，禁止炫学堆砌；Flesch 阅读指数≥90。
    输出格式，请严格按照MD格式
    现在开始，请率先调用“第壹章”并严格执行以上全部细则。
    ```
    
![](Pasted_image_20251022210239.png)

### 🚀 Part 4：测试

1. **保存：** 点击右上角的 **"Save" (保存)** 按钮。
    
2. **激活：** 点击画布顶部的 **"Inactive" (未激活)** 开关，使其变为 **"Active" (激活)** 状态。
    
3. **开始聊天：**
    
    - 点击 **"Chat Trigger"** 节点。
        
    - 在右侧面板找到 "Webhook URL"，点击旁边的 **"Open Chat" (打开聊天)** 图标。
![](Pasted_image_20251022210410.png)
        
    - 在新打开的聊天窗口中，输入你的问题，例如：“请帮我分析一下《滕王阁序》的写作特色。”
        
    - 观察 AI “导师”严格按照你的章回体格式进行的精彩回复！
        
4. **下载存档：**
    
    - 当 AI 回答**完全停止**后，回到 n8n 画布界面。
        
    - 在左上角找到 **"Executions" (执行记录)** 按钮并点击它。
        
    - 找到刚刚成功的那条执行记录（状态为 `Completed`），点击它。
        
    - 在弹出的执行视图中，点击最后一个 **"Convert to File"** 节点。
        
    - 在右侧的输出面板中，切换到 **"Binary" (二进制)** 标签页。
        
    - 你会看到 `语文导师回复.html` 文件。点击 **"Download" (下载)** 按钮！
    
![](Pasted_image_20251022211225.png)

恭喜！你已经从零开始，完整复刻了这个功能强大、人设专业的 AI 聊天机器人工作流。